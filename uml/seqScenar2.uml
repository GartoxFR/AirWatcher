@startuml

skinparam responseMessageBelowArrow true

actor User as user

participant "Interface\nUtilisateur" as ui
participant "Authentification\nLayer" as auth
participant "Data Processing\nLayer" as proc
participant "MeasurementValue" as m
participant "Sensor" as sensor
participant "Dataset" as data

user -> ui: 0: Authentification
activate ui

ui -> auth: 0: getMenus()
activate auth

auth -> ui: 0: vector<MenuItem*>
deactivate auth

ui -> user: 0: Affichage menu
deactivate ui

user -> ui: 0: Choix recherche de\ncapteurs similaires
activate ui

ui -> auth: 0: MenuItem::Call()

activate auth
auth -> proc: 0: CalculSimiliarite()
activate proc

proc -> data: 0: GetSensorById()
activate data
data -> proc: 0: Sensor*
deactivate data
proc -> sensor: 0: getMeasurementsInPeriod()
activate sensor
sensor -> proc: 0: vector<Measurement*>
deactivate sensor
loop mesure <- vector<Measurement*>
    proc -> m: 0: operator+=()
end loop

proc -> m: 0: operator/=()
deactivate sensor

proc -> data: 0: getSensors()
activate data
data -> proc: 0: vector<Sensor*>
deactivate data


loop sensor <- vector<Sensor*>
    proc -> sensor: 0: getMeasurementsInPeriod()
    activate sensor
    sensor -> proc: 0: vector<Measurement*>
    deactivate sensor
    loop mesure <- vector<Measurement*>
        proc -> m: 0: operator+=()
    end loop

    proc -> m: 0: operator/=()

    proc -> m: 0: ComputeSimilarity()
    activate m
    m -> proc: 0: double
    deactivate m
end loop

proc -> auth: 0: multimap<double,Sensor*>
deactivate proc

auth -> ui: 0: Printable
deactivate auth

ui -> user: 0: Printable::Print()
deactivate ui

@enduml
